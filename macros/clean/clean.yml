version: 2

macros:
  - name: clean_functions
    description: Reconcile dbt-defined user defined functions vs deployed; drop any orphaned in Snowflake.
    docs:
      show: true
    arguments:
      - name: database
        type: string
        description: target database
      - name: dry_run
        type: boolean
        description: specifies if the macro should run in dry run mode

  - name: clean_generic
    description: Reconcile streams / tasks / stages vs dbt definitions; drop those no longer present.
    docs:
      show: true
    arguments:
      - name: object_type
        type: string
        description: type of object to clean (TASK, STREAM, STAGE)
      - name: database
        type: string
        description: target database
      - name: dry_run
        type: boolean
        description: specifies if the macro should run in dry run mode

  - name: clean_models
    description: Reconcile dbt tables, external tables & views with deployed objects; remove orphans.
    docs:
      show: true
    arguments:
      - name: database
        type: string
        description: target database
      - name: dry_run
        type: boolean
        description: specifies if the macro should run in dry run mode

  - name: clean_objects
    description: Convenience orchestrator to run all clean_* macros (suitable for post-hook usage).
    docs:
      show: true
    arguments:
      - name: database
        type: string
        description: target database
      - name: clean_targets
        type: List[string]
        description: List of environments to clean in
      - name: object_types
        type: List[string]
        description: List of object types to clean up
     

  - name: clean_schemas
    description: Reconcile schema list vs dbt; drop schemas no longer defined.
    docs:
      show: true
    arguments:
      - name: database
        type: string
        description: target database
      - name: dry_run
        type: boolean
        description: specifies if the macro should run in dry run mode

  - name: drop_object
    description: This macro compares executes 
    docs:
      show: false
    arguments:
      - name: object_type
        type: string
        description: type of objectwhich is being dropped
      - name: database
        type: string
        description: target database
      - name: items_to_drop
        type: list
        description: list of objects to drop
      - name: dry_run
        type: boolean
        description: specifies if the macro should run in dry run mode

  - name: has_matching_nodes
    description: This macro checks to see if the sql object exists in dbt
    docs:
      show: false
    arguments:
      - name: nodes
        type: string
        description: graph of nodes to check against
      - name: name_property
        type: string
        description: name of the property to check against (name or config.override_name)
      - name: sql_object_schema
        type: string
        description: schema name
      - name: sql_object_name
        type: string
        description: object name
      - name: sql_arguments
        type: string
        description: arguments of the sql object

  - name: clean_stale_models
    description: Drop models in a schema older than N days (stale artifact cleanup).
    docs:
      show: true
    arguments:
      - name: database
        type: string
        description: target database
      - name: schema
        type: string
        description: target schema
      - name: days
        type: string
        description: number of days old 
      - name: dry_run
        type: boolean
        description: specifies if the macro should run in dry run mode